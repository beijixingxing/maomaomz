const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["index.js","index.css"])))=>i.map(i=>d[i]);
import{_ as e}from'./index.js';async function t(t,n,r){const{filterApiParams:o}=await e(async()=>{const{filterApiParams:e}=await import('./index.js').then(e=>e.s);return{filterApiParams:e}},__vite__mapDeps([0,1])),{normalizeApiEndpoint:i}=await e(async()=>{const{normalizeApiEndpoint:e}=await import('./index.js').then(e=>e.s);return{normalizeApiEndpoint:e}},__vite__mapDeps([0,1]));if(n.use_tavern_api){if(console.log('ğŸº ä½¿ç”¨é…’é¦† API å‘é€è¯·æ±‚ï¼ˆç»•è¿‡ CORSï¼‰...'),'undefined'==typeof SillyTavern||'function'!=typeof SillyTavern.generateQuietPrompt)throw new Error('é…’é¦† API ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿åœ¨ SillyTavern ç¯å¢ƒä¸­è¿è¡Œï¼Œæˆ–å…³é—­"ä½¿ç”¨é…’é¦† API"é€‰é¡¹');const e=t.map(e=>e.content).join('\n\n'),o=SillyTavern.generateQuietPrompt(),i=await o(e,!1,!0,void 0,void 0,n.max_tokens);if(!i||''===i.trim())throw new Error('é…’é¦† API è¿”å›äº†ç©ºç»“æœ');return r?.onProgress?.(100),console.log('âœ… é€šè¿‡é…’é¦† API æˆåŠŸè·å–å“åº”'),i.trim()}const a=i(n.api_endpoint),s=o({model:n.model||'gpt-3.5-turbo',max_tokens:n.max_tokens||4e3,temperature:r?.temperature??n.temperature??.7,top_p:n.top_p,presence_penalty:n.presence_penalty,frequency_penalty:n.frequency_penalty,messages:t},n.api_endpoint),p=await fetch(a,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${n.api_key}`},body:JSON.stringify(s)});if(!p.ok){const e=await p.text();throw new Error(`API è¯·æ±‚å¤±è´¥ (${p.status}): ${e}`)}const m=await p.json();return r?.onProgress?.(100),m.choices?.[0]?.message?.content?.trim()||''}export{t as callAIWithTavernSupport};
//# sourceMappingURL=api.C3eD0e8c.chunk.js.map
