{"version":3,"file":"Ê∑ªÂä†ÂØºËà™ÊåâÈíÆ.D4VySo6M.chunk.js","sources":["../src/ËÆ∞ÂøÜ_with_worldbook/Ê∑ªÂä†ÂØºËà™ÊåâÈíÆ.ts"],"sourcesContent":["$(() => {\n  // Âª∂ËøüÂàùÂßãÂåñÔºåÁ°Æ‰øùÈÖíÈ¶ÜÂÆåÂÖ®Âä†ËΩΩ\n  setTimeout(() => {\n    let isAdding = false;\n\n    const addNavButton = () => {\n      // Èò≤Ê≠¢ÈáçÂ§çÊ∑ªÂä†\n      if (isAdding) {\n        return;\n      }\n      isAdding = true;\n      try {\n        // Â∞ùËØïÂ§ö‰∏™ÂèØËÉΩÁöÑÂØºËà™Ê†èÈÄâÊã©Âô®\n        const possibleSelectors = [\n          '#top-bar', // ‰ªé‰Ω†Êèê‰æõÁöÑ HTML ÁúãÂà∞ÁöÑ\n          '#top-settings-holder', // ‰ªé‰Ω†Êèê‰æõÁöÑ HTML ÁúãÂà∞ÁöÑ\n          '#topBar',\n          '.topBar',\n          '#navbar',\n          '.navbar',\n          'header',\n          '.header',\n          '#header',\n          '.top_header',\n          '.navigation',\n        ];\n\n        let topBar: JQuery<HTMLElement> = $();\n        let foundSelector = '';\n\n        for (const selector of possibleSelectors) {\n          const found = $(selector);\n          if (found.length > 0) {\n            topBar = found;\n            foundSelector = selector;\n            console.log(`ÊâæÂà∞ÂØºËà™Ê†è: ${selector}`);\n            break;\n          }\n        }\n\n        if (topBar.length === 0) {\n          console.log('Êú™ÊâæÂà∞ÂØºËà™Ê†èÔºå500msÂêéÈáçËØï...');\n          setTimeout(addNavButton, 500);\n          return;\n        }\n\n        console.log(`‰ΩøÁî®ÂØºËà™Ê†è: ${foundSelector}`);\n\n        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊ∑ªÂä†Ëøá\n        const existingButton = $('#memoryNavButton');\n        if (existingButton.length > 0) {\n          console.log('mzrodyuÁå´Áå´ÁöÑÂ∞èÁ†¥ÁÉÇÂØºËà™ÊåâÈíÆÂ∑≤Â≠òÂú®ÔºåÁßªÈô§ÂêéÈáçÊñ∞Ê∑ªÂä†');\n          existingButton.remove();\n        }\n\n        // Êü•ÊâæÊ≠£Á°ÆÁöÑÂÆπÂô® - Â¶ÇÊûúÊòØ top-barÔºåÊü•Êâæ top-settings-holder\n        let targetContainer = topBar;\n        if (foundSelector === '#top-bar') {\n          const settingsHolder = $('#top-settings-holder');\n          if (settingsHolder.length > 0) {\n            targetContainer = settingsHolder;\n            console.log('‰ΩøÁî® top-settings-holder ‰Ωú‰∏∫ÂÆπÂô®');\n          }\n        }\n\n        // ÂàõÂª∫ÊåâÈíÆ - Âè™ÊòæÁ§∫ÂõæÊ†áÔºåÂíåÂÖ∂‰ªñÂõæÊ†á‰∏ÄËá¥\n        const navButton = $(\n          `<div id=\"memoryNavButton\" class=\"interactable\" style=\"\n            padding: 8px;\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            cursor: pointer;\n            color: inherit;\n            border-radius: 4px;\n            transition: background 0.2s;\n            position: relative;\n          \" title=\"mzrodyuÁå´Áå´ÁöÑÂ∞èÁ†¥ÁÉÇ\">\n            <span style=\"font-size: 24px\">üê±</span>\n          </div>`,\n        );\n\n        // ÊâìÂç∞ÂØºËà™Ê†èÁªìÊûÑÁî®‰∫éË∞ÉËØï\n        console.log('ÁõÆÊ†áÂÆπÂô®Á±ªÂûã:', targetContainer[0]?.id || 'Êú™ÊåáÂÆö');\n        console.log('ÁõÆÊ†áÂÆπÂô®HTML:', targetContainer[0]?.outerHTML?.substring(0, 300));\n\n        // Â¶ÇÊûú targetContainer Â∞±ÊòØ top-settings-holderÔºåÊ∑ªÂä†Âà∞ÊúÄÂâçÈù¢\n        if (targetContainer[0]?.id === 'top-settings-holder') {\n          console.log('Ê∑ªÂä†Âà∞ top-settings-holder ÊúÄÂâçÈù¢');\n          const firstChild = targetContainer.children().first();\n          if (firstChild.length > 0) {\n            navButton.insertBefore(firstChild);\n          } else {\n            targetContainer.prepend(navButton);\n          }\n        } else {\n          // ÂØπ‰∫éÂÖ∂‰ªñÂÆπÂô®ÔºåÊ∑ªÂä†Âà∞ÂâçÈù¢\n          console.log('Ê∑ªÂä†Âà∞ÂÆπÂô®ÂâçÈù¢');\n          targetContainer.prepend(navButton);\n        }\n\n        // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂ - ÊâìÂºÄÊµÆÂä®Èù¢Êùø\n        navButton.on('click', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n\n          console.log('ÁÇπÂáªmzrodyuÁå´Áå´ÁöÑÂ∞èÁ†¥ÁÉÇÂØºËà™ÊåâÈíÆ');\n\n          // ÊâìÂºÄÊµÆÂä®Èù¢Êùø\n          const panel = $('#memoryManagementPanel');\n          if (panel.length > 0) {\n            if (panel.is(':visible')) {\n              panel.fadeOut(200);\n            } else {\n              panel.fadeIn(200);\n            }\n          } else {\n            toastr.error('ÊµÆÂä®Èù¢ÊùøÊú™Âä†ËΩΩ');\n          }\n        });\n\n        // Ê∑ªÂä†Èº†Ê†áÊÇ¨ÂÅúÊïàÊûú\n        navButton\n          .on('mouseenter', function () {\n            $(this).css('background', 'rgba(255, 255, 255, 0.1)');\n          })\n          .on('mouseleave', function () {\n            $(this).css('background', 'transparent');\n          });\n\n        console.log('mzrodyuÁå´Áå´ÁöÑÂ∞èÁ†¥ÁÉÇÂØºËà™ÊåâÈíÆÂ∑≤Ê∑ªÂä†Âà∞:', targetContainer[0]?.id || 'ÂÆπÂô®');\n        console.log('ÊåâÈíÆ‰ΩçÁΩÆ:', navButton[0]?.parentElement?.children?.[0]?.className || 'Â∑≤Ê∑ªÂä†');\n        console.log('ÊåâÈíÆÂÖÉÁ¥†:', navButton[0]);\n        console.log('Èù¢ÊùøÂÆπÂô®ÈïøÂ∫¶:', $('#memoryManagementPanel').length);\n        isAdding = false;\n      } catch (error) {\n        console.error('Ê∑ªÂä†ÂØºËà™ÊåâÈíÆÂ§±Ë¥•:', error);\n        isAdding = false;\n        setTimeout(addNavButton, 500);\n      }\n    };\n\n    // ÂàùÂßãÊ∑ªÂä†\n    addNavButton();\n\n    // ÊØè2ÁßíÊ£ÄÊü•‰∏ÄÊ¨°ÊåâÈíÆÊòØÂê¶Â≠òÂú®ÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®Â∞±ÈáçÊñ∞Ê∑ªÂä†\n    setInterval(() => {\n      const button = $('#memoryNavButton');\n      if (button.length === 0 && !isAdding) {\n        console.log('Ê£ÄÊµãÂà∞ÊåâÈíÆÊ∂àÂ§±ÔºåÈáçÊñ∞Ê∑ªÂä†...');\n        addNavButton();\n      }\n    }, 2000);\n\n    // ÁõëÂê¨ÈÖíÈ¶ÜÁöÑÂêÑÁßçÂèØËÉΩÂØºËá¥UIÊõ¥Êñ∞ÁöÑ‰∫ã‰ª∂ÔºàÊèí‰ª∂ÁéØÂ¢É - ‰ΩøÁî® SillyTavern.eventSourceÔºâ\n    if (typeof SillyTavern !== 'undefined' && SillyTavern.eventSource) {\n      try {\n        // ÁõëÂê¨ËÅäÂ§©ÂèòÂåñ\n        SillyTavern.eventSource.on(SillyTavern.eventTypes.CHAT_CHANGED, () => {\n          console.log('ËÅäÂ§©ÂèòÂåñÔºåÊ£ÄÊü•ÊåâÈíÆ...');\n          setTimeout(() => {\n            const button = $('#memoryNavButton');\n            if (button.length === 0 && !isAdding) {\n              console.log('ËÅäÂ§©ÂèòÂåñÂêéÊåâÈíÆÊ∂àÂ§±ÔºåÈáçÊñ∞Ê∑ªÂä†...');\n              addNavButton();\n            }\n          }, 500);\n        });\n      } catch (e) {\n        console.log('Êó†Ê≥ïÁõëÂê¨‰∫ã‰ª∂:', e);\n      }\n    } else if (\n      typeof (window as any).TavernHelper !== 'undefined' &&\n      typeof (window as any).TavernHelper.eventOn === 'function'\n    ) {\n      // ÈôçÁ∫ßÔºö‰ΩøÁî® TavernHelper (ÈÖíÈ¶ÜÂä©ÊâãÁéØÂ¢É)\n      try {\n        const TavernHelper = (window as any).TavernHelper;\n        const tavern_events = (window as any).tavern_events;\n        TavernHelper.eventOn(tavern_events.CHAT_CHANGED, () => {\n          console.log('ËÅäÂ§©ÂèòÂåñÔºåÊ£ÄÊü•ÊåâÈíÆ...');\n          setTimeout(() => {\n            const button = $('#memoryNavButton');\n            if (button.length === 0 && !isAdding) {\n              console.log('ËÅäÂ§©ÂèòÂåñÂêéÊåâÈíÆÊ∂àÂ§±ÔºåÈáçÊñ∞Ê∑ªÂä†...');\n              addNavButton();\n            }\n          }, 500);\n        });\n      } catch (e) {\n        console.log('Êó†Ê≥ïÁõëÂê¨‰∫ã‰ª∂:', e);\n      }\n    }\n  }, 300);\n});\n"],"names":["$","setTimeout","isAdding","addNavButton","possibleSelectors","topBar","foundSelector","selector","found","length","console","log","existingButton","remove","targetContainer","settingsHolder","navButton","id","outerHTML","substring","firstChild","children","first","insertBefore","prepend","on","e","preventDefault","stopPropagation","panel","is","fadeOut","fadeIn","toastr","error","this","css","parentElement","className","setInterval","SillyTavern","eventSource","eventTypes","CHAT_CHANGED","window","TavernHelper","eventOn","tavern_events"],"mappings":"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"}